{
	"info": {
		"_postman_id": "9296da61-5164-4bd8-9284-338435eeda88",
		"name": "Open Finance Hackathon",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json",
		"_exporter_id": "10637960"
	},
	"item": [
		{
			"name": "TPP Onboarding",
			"item": [
				{
					"name": "POST registration",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "x-cert-dn",
								"value": "CN=e14a49e6-8ad4-4dcf-bd2e-85a38fe8752c,OU=233bcd1d-4216-4b3c-a362-9e4a9282bba7,O=RAIDIAM SERVICES LIMITED,C=UK",
								"type": "text",
								"disabled": true
							},
							{
								"key": "x-fapi-interaction-id",
								"value": "{{$randomUUID}}",
								"type": "text"
							},
							{
								"key": "x-cert-dn",
								"value": "CN=37ab0f6e-ecee-4f3b-a99d-2d876df1dcbc,OU=73423662-b345-453e-a54b-2f9115a6a45d,O=RAIDIAM SERVICES LIMITED,C=UK",
								"type": "text",
								"disabled": true
							}
						],
						"url": {
							"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/tpp-registration",
							"protocol": "https",
							"host": [
								"rs1",
								"altareq1",
								"sandbox",
								"apihub",
								"openfinance",
								"ae"
							],
							"path": [
								"tpp-registration"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Data Sharing",
			"item": [
				{
					"name": "AuthFlow",
					"item": [
						{
							"name": "O3 Util: Prepare request object JWT for PAR end-point",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"pm.environment.set(\"exp\", Date.now() / 1000 + 60);",
											"pm.environment.set(\"nbf\", (Date.now() / 1000) - 10);",
											"pm.environment.set(\"today\", new Date().toISOString().split('T')[0]);",
											"",
											"",
											"const uuid = require('uuid');",
											"",
											"const codeVerifier = uuid.v4() + uuid.v4();",
											"",
											"const hashedCodeVerifier = CryptoJS.SHA256(codeVerifier);",
											"let codeChallenge = CryptoJS.enc.Base64.stringify(hashedCodeVerifier);",
											"",
											"console.log(codeVerifier);",
											"console.log(hashedCodeVerifier);",
											"console.log(codeChallenge);",
											"codeChallenge = codeChallenge.replaceAll('+', '-');",
											"codeChallenge = codeChallenge.replaceAll('/', '_');",
											"if (codeChallenge.endsWith('=')) { codeChallenge = codeChallenge.substring(0, codeChallenge.length - 1)}",
											"console.log(codeChallenge);",
											"",
											"pm.environment.set(\"code-challenge\", codeChallenge );",
											"pm.environment.set(\"code-verifier\", codeVerifier );"
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.environment.set(\"requestObject\", responseBody);",
											"var a = responseBody.split('.');",
											"var words = CryptoJS.enc.Base64.parse(a[1]);",
											"var bodyData = CryptoJS.enc.Utf8.stringify(words);",
											"console.log(bodyData);",
											"var jsonData = JSON.parse(bodyData);",
											"console.log(jsonData);",
											"",
											"pm.environment.set(\"response_type\", jsonData.response_type);",
											"pm.environment.set(\"scope\", jsonData.scope);",
											"",
											"pm.environment.set(\"data-sharing-base-consent-id\", jsonData.authorization_details[0].consent.ConsentId);",
											"pm.environment.set(\"data-sharing-consent-id\", jsonData.authorization_details[0].consent.ConsentId);",
											"",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "content-type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"header\": {\n        \"alg\": \"PS256\",\n        \"kid\": \"{{kid-local}}\"\n    },\n    \"body\": {\n        \"aud\": \"https://auth1.altareq1.sandbox.apihub.openfinance.ae\",\n        \"exp\": {{exp}},\n        \"iss\": \"{{_clientId}}\",\n        \"scope\": \"accounts openid\",\n        \"redirect_uri\": \"https://ob-testing.onrender.com/callback\",\n        \"client_id\": \"{{_clientId}}\",\n        \"nonce\": \"{{$guid}}\",\n        \"state\": \"{{$guid}}\",\n        \"nbf\": {{nbf}},\n        \"response_type\": \"code\",\n        \"code_challenge_method\": \"S256\",\n        \"code_challenge\": \"{{code-challenge}}\",\n        \"max_age\": 3600,\n        \"authorization_details\": [\n            {\n                \"type\": \"urn:openfinanceuae:account-access-consent:v1.2\",\n                \"consent\": {\n                    \"ExpirationDateTime\": \"{{today}}T23:00:00.000Z\",\n                    \"OnBehalfOf\": {\n                        \"TradingName\": \"Ozone\",\n                        \"LegalName\": \"Ozone-CBUAE\",\n                        \"IdentifierType\": \"Other\",\n                        \"Identifier\": \"Identifier\"\n                    },\n                    \"ConsentId\": \"{{$guid}}\",\n                    // \"BaseConsentId\": \"b9f42378-10ac-46a1-8d20-4e020484216d\",\n                    \"Permissions\": [\n                        \"ReadTransactionsCredits\",\n                        \"ReadAccountsBasic\",\n                        \"ReadBalances\",\n                        \"ReadTransactionsBasic\",\n                        \"ReadTransactionsDetail\",\n                        \"ReadDirectDebits\",\n                        \"ReadBeneficiariesDetail\",\n                        \"ReadBeneficiariesBasic\",\n                        \"ReadScheduledPaymentsBasic\",\n                        \"ReadScheduledPaymentsDetail\",\n                        \"ReadStandingOrdersBasic\",\n                        \"ReadStandingOrdersDetail\",\n                        \"ReadParty\",\n                        \"ReadPartyUserIdentity\",\n                        \"ReadProduct\"\n                    ],\n                    //  \"TransactionFromDateTime\": \"2025-03-01T23:00:00.000Z\",\n                    //  \"TransactionToDateTime\": \"2025-03-31T23:00:00.000Z\",\n                    \"OpenFinanceBilling\": {\n                        \"UserType\": \"Retail\",\n                        \"Purpose\": \"AccountAggregation\"\n                    }\n                },\n                \"subscription\": {\n                    \"Webhook\": {\n                        \"Url\": \"https://rs1.altareq1.sandbox.apihub.openfinance.ae/mock-event-receiver\",\n                        \"IsActive\": true\n                    }\n                }\n            }\n        ]\n    },\n    \"signingKeyPEM\": \"{{pem-local}}\"\n}"
								},
								"url": {
									"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/o3/v1.0/message-signature",
									"protocol": "https",
									"host": [
										"rs1",
										"altareq1",
										"sandbox",
										"apihub",
										"openfinance",
										"ae"
									],
									"path": [
										"o3",
										"v1.0",
										"message-signature"
									]
								}
							},
							"response": []
						},
						{
							"name": "O3 Util: Prepare private key JWT for PAR end-point",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"pm.environment.set(\"exp\", Date.now() / 1000 + 300);",
											"pm.environment.set(\"nbf\", (Date.now() / 1000) - 10);",
											"const uuid = require('uuid');"
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											"pm.environment.set(\"private_key_jwt\", responseBody);"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disableBodyPruning": true
							},
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "content-type",
										"value": "application/json"
									}
								],
								"body": {
									"mode": "raw",
									"raw": "{\n    \"header\": {\n        \"alg\": \"PS256\",\n        \"kid\": \"{{kid-local}}\"\n    },\n    \"body\": {\n        \"aud\": \"https://auth1.altareq1.sandbox.apihub.openfinance.ae\",\n        \"exp\": {{exp}},\n        \"iss\": \"{{_clientId}}\",\n        \"sub\": \"{{_clientId}}\",\n        \"jti\": \"{{$guid}}\",\n        \"iat\": {{nbf}}\n    },\n    \"signingKeyPEM\": \"{{pem-local}}\"\n}"
								},
								"url": {
									"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/o3/v1.0/message-signature",
									"protocol": "https",
									"host": [
										"rs1",
										"altareq1",
										"sandbox",
										"apihub",
										"openfinance",
										"ae"
									],
									"path": [
										"o3",
										"v1.0",
										"message-signature"
									]
								}
							},
							"response": []
						},
						{
							"name": "4000: TPP-API Hub: POST to PAR end-point",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"let jsonData = JSON.parse(pm.response.text());",
											"",
											"pm.environment.set(\"par-urn\", jsonData.request_uri);",
											"",
											"const clientId = pm.environment.get(\"_clientId\");",
											"const authEndpoint = 'https://auth1.altareq1.sandbox.apihub.openfinance.ae/auth';",
											"const response_type = pm.environment.get('response_type');",
											"const authCodeUrl = `${authEndpoint}?client_id=${clientId}&response_type=${response_type}&scope=openid&request_uri=${jsonData.request_uri}`;",
											"",
											"pm.environment.set(\"authCodeUrl\", authCodeUrl);",
											"",
											"if (pm.response.code === 201) {",
											"    var myUrl = utils.splitAndEncodeURL(authCodeUrl)",
											"    var template = utils.visualizer.qrTemplate1();",
											"    var data = utils.visualizer.qrData(myUrl);",
											"",
											"    utils.visualizer.draw(pm.visualizer, template, {",
											"        response: data",
											"    })",
											"}",
											"",
											"// encode the url ",
											"var responseBody = authCodeUrl.replace('adcb://uat.mib.pn/auth', pm.environment.get('authEndpoint'))",
											"pm.environment.set(\"authCodeUrl\", responseBody);",
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/x-www-form-urlencoded",
										"type": "text"
									},
									{
										"key": "x-cert-dn",
										"value": "CN=e14a49e6-8ad4-4dcf-bd2e-85a38fe8752c,OU=233bcd1d-4216-4b3c-a362-9e4a9282bba7,O=RAIDIAM SERVICES LIMITED,C=UK",
										"type": "text",
										"disabled": true
									}
								],
								"body": {
									"mode": "urlencoded",
									"urlencoded": [
										{
											"key": "client_id",
											"value": "{{_clientId}}",
											"type": "text"
										},
										{
											"key": "request",
											"value": "{{requestObject}}",
											"type": "default"
										},
										{
											"key": "client_assertion_type",
											"value": "urn:ietf:params:oauth:client-assertion-type:jwt-bearer",
											"type": "text"
										},
										{
											"key": "client_assertion",
											"value": "{{private_key_jwt}}",
											"type": "text"
										}
									]
								},
								"url": {
									"raw": "https://as1.altareq1.sandbox.apihub.openfinance.ae/par",
									"protocol": "https",
									"host": [
										"as1",
										"altareq1",
										"sandbox",
										"apihub",
										"openfinance",
										"ae"
									],
									"path": [
										"par"
									]
								}
							},
							"response": []
						},
						{
							"name": "7002: TPP-API Hub: Auth Code Grant",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"let jsonData = JSON.parse(responseBody);",
											"pm.environment.set(\"token-from-auth-code-grant-accounts\", jsonData.access_token);",
											"pm.environment.set(\"refresh_token\", jsonData.refresh_token);"
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"packages": {},
										"type": "text/javascript"
									}
								}
							],
							"request": {
								"method": "POST",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/x-www-form-urlencoded",
										"type": "text"
									},
									{
										"key": "x-cert-dn",
										"value": "CN=e14a49e6-8ad4-4dcf-bd2e-85a38fe8752c,OU=233bcd1d-4216-4b3c-a362-9e4a9282bba7,O=RAIDIAM SERVICES LIMITED,C=UK",
										"type": "text",
										"disabled": true
									}
								],
								"body": {
									"mode": "urlencoded",
									"urlencoded": [
										{
											"key": "grant_type",
											"value": "authorization_code",
											"type": "text"
										},
										{
											"key": "code",
											"value": "{{authorizationCode}}",
											"type": "text"
										},
										{
											"key": "redirect_uri",
											"value": "https://ob-testing.onrender.com/callback",
											"type": "text"
										},
										{
											"key": "code_verifier",
											"value": "{{code-verifier}}",
											"type": "default"
										},
										{
											"key": "client_assertion_type",
											"value": "urn:ietf:params:oauth:client-assertion-type:jwt-bearer",
											"type": "text"
										},
										{
											"key": "client_assertion",
											"value": "{{private_key_jwt}}",
											"type": "text"
										}
									]
								},
								"url": {
									"raw": "https://as1.altareq1.sandbox.apihub.openfinance.ae/token",
									"protocol": "https",
									"host": [
										"as1",
										"altareq1",
										"sandbox",
										"apihub",
										"openfinance",
										"ae"
									],
									"path": [
										"token"
									]
								},
								"description": "Copy the authorization code generated into the browser into the **Body** tab in the `code` parameter"
							},
							"response": []
						}
					],
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						},
						{
							"listen": "test",
							"script": {
								"type": "text/javascript",
								"exec": [
									""
								]
							}
						}
					]
				},
				{
					"name": "Data Sharing APIs (application/json)",
					"item": [
						{
							"name": "8000: TPP-API Hub: GET multiple accounts",
							"event": [
								{
									"listen": "test",
									"script": {
										"exec": [
											"var jsonData = JSON.parse(responseBody);",
											"pm.environment.set(\"account-id\", jsonData.Data.Account[0].AccountId);"
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"// set uuid and time",
											"pm.environment.set(\"now\", (new Date()).toUTCString());",
											"const uuid = require('uuid');",
											"pm.environment.set(\"x-fapi-interaction-id\", uuid.v4());"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{token-from-auth-code-grant-accounts}}",
										"type": "text"
									},
									{
										"key": "x-fapi-financial-id",
										"value": "{{obParticipantId}}",
										"type": "text"
									},
									{
										"key": "x-fapi-interaction-id",
										"value": "{{x-fapi-interaction-id}}",
										"type": "text"
									},
									{
										"key": "x-fapi-auth-date",
										"value": "Sat, 15 Mar 2025 19:43:31 UTC",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-fapi-customer-ip-address",
										"value": "192.168.1.1",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-customer-user-agent",
										"value": "Chrome/114.0.5735.110",
										"type": "text",
										"disabled": true
									}
								],
								"url": {
									"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/open-finance/account-information/v1.2/accounts",
									"protocol": "https",
									"host": [
										"rs1",
										"altareq1",
										"sandbox",
										"apihub",
										"openfinance",
										"ae"
									],
									"path": [
										"open-finance",
										"account-information",
										"v1.2",
										"accounts"
									]
								}
							},
							"response": []
						},
						{
							"name": "8001: TPP-API Hub: GET accounts/{accountId}",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const uuid = require('uuid');",
											"pm.environment.set(\"x-fapi-interaction-id\", uuid.v4());"
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{token-from-auth-code-grant-accounts}}",
										"type": "text"
									},
									{
										"key": "x-fapi-financial-id",
										"value": "{{obParticipantId}}",
										"type": "text"
									},
									{
										"key": "x-fapi-interaction-id",
										"value": "{{x-fapi-interaction-id}}",
										"type": "text"
									},
									{
										"key": "x-fapi-auth-date",
										"value": "Sat, 15 Mar 2025 19:43:31 UTC",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-fapi-customer-ip-address",
										"value": "192.168.1.1",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-customer-user-agent",
										"value": "Chrome/114.0.5735.110",
										"type": "text",
										"disabled": true
									}
								],
								"url": {
									"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/open-finance/account-information/v1.2/accounts/{{account-id}}",
									"protocol": "https",
									"host": [
										"rs1",
										"altareq1",
										"sandbox",
										"apihub",
										"openfinance",
										"ae"
									],
									"path": [
										"open-finance",
										"account-information",
										"v1.2",
										"accounts",
										"{{account-id}}"
									]
								}
							},
							"response": []
						},
						{
							"name": "8002: TPP-API Hub: GET accounts/{accountId}/balances",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const uuid = require('uuid');",
											"pm.environment.set(\"x-fapi-interaction-id\", uuid.v4());"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{token-from-auth-code-grant-accounts}}",
										"type": "text"
									},
									{
										"key": "x-fapi-financial-id",
										"value": "{{obParticipantId}}",
										"type": "text"
									},
									{
										"key": "x-fapi-interaction-id",
										"value": "{{x-fapi-interaction-id}}",
										"type": "text"
									},
									{
										"key": "x-fapi-auth-date",
										"value": "Sat, 15 Mar 2025 19:43:31 UTC",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-fapi-customer-ip-address",
										"value": "192.168.1.1",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-customer-user-agent",
										"value": "Chrome/114.0.5735.110",
										"type": "text",
										"disabled": true
									}
								],
								"url": {
									"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/open-finance/account-information/v1.2/accounts/{{account-id}}/balances",
									"protocol": "https",
									"host": [
										"rs1",
										"altareq1",
										"sandbox",
										"apihub",
										"openfinance",
										"ae"
									],
									"path": [
										"open-finance",
										"account-information",
										"v1.2",
										"accounts",
										"{{account-id}}",
										"balances"
									],
									"query": [
										{
											"key": "toBookingDateTime",
											"value": "2023-12-29T23:00:00.000Z",
											"disabled": true
										}
									]
								}
							},
							"response": []
						},
						{
							"name": "8010: TPP-API Hub: GET accounts/{accountId}/parties",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const uuid = require('uuid');",
											"pm.environment.set(\"x-fapi-interaction-id\", uuid.v4());"
										],
										"type": "text/javascript",
										"packages": {}
									}
								},
								{
									"listen": "test",
									"script": {
										"exec": [
											""
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{token-from-auth-code-grant-accounts}}",
										"type": "text"
									},
									{
										"key": "x-fapi-financial-id",
										"value": "{{obParticipantId}}",
										"type": "text"
									},
									{
										"key": "x-fapi-interaction-id",
										"value": "{{x-fapi-interaction-id}}",
										"type": "text"
									},
									{
										"key": "x-fapi-auth-date",
										"value": "Sat, 15 Mar 2025 19:43:31 UTC",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-fapi-customer-ip-address",
										"value": "192.168.1.1",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-customer-user-agent",
										"value": "Chrome/114.0.5735.110",
										"type": "text",
										"disabled": true
									}
								],
								"url": {
									"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/open-finance/account-information/v1.2/accounts/{{account-id}}/parties",
									"protocol": "https",
									"host": [
										"rs1",
										"altareq1",
										"sandbox",
										"apihub",
										"openfinance",
										"ae"
									],
									"path": [
										"open-finance",
										"account-information",
										"v1.2",
										"accounts",
										"{{account-id}}",
										"parties"
									]
								}
							},
							"response": []
						},
						{
							"name": "8009: TPP-API Hub: GET /parties",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const uuid = require('uuid');",
											"pm.environment.set(\"x-fapi-interaction-id\", uuid.v4());"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{token-from-auth-code-grant-accounts}}",
										"type": "text"
									},
									{
										"key": "x-fapi-financial-id",
										"value": "{{obParticipantId}}",
										"type": "text"
									},
									{
										"key": "x-fapi-interaction-id",
										"value": "{{x-fapi-interaction-id}}",
										"type": "text"
									},
									{
										"key": "x-fapi-auth-date",
										"value": "Sat, 15 Mar 2025 19:43:31 UTC",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-fapi-customer-ip-address",
										"value": "192.168.1.1",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-customer-user-agent",
										"value": "Chrome/114.0.5735.110",
										"type": "text",
										"disabled": true
									}
								],
								"url": {
									"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/open-finance/account-information/v1.2/parties",
									"protocol": "https",
									"host": [
										"rs1",
										"altareq1",
										"sandbox",
										"apihub",
										"openfinance",
										"ae"
									],
									"path": [
										"open-finance",
										"account-information",
										"v1.2",
										"parties"
									]
								}
							},
							"response": []
						},
						{
							"name": "8008: TPP-API Hub: GET accounts/{accountId}/product",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const uuid = require('uuid');",
											"pm.environment.set(\"x-fapi-interaction-id\", uuid.v4());"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"protocolProfileBehavior": {
								"disabledSystemHeaders": {},
								"followOriginalHttpMethod": false
							},
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{token-from-auth-code-grant-accounts}}",
										"type": "text"
									},
									{
										"key": "x-fapi-financial-id",
										"value": "{{obParticipantId}}",
										"type": "text"
									},
									{
										"key": "x-fapi-interaction-id",
										"value": "{{x-fapi-interaction-id}}",
										"type": "text"
									},
									{
										"key": "x-fapi-auth-date",
										"value": "Sat, 15 Mar 2025 19:43:31 UTC",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-fapi-customer-ip-address",
										"value": "192.168.1.1",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-customer-user-agent",
										"value": "Chrome/114.0.5735.110",
										"type": "text",
										"disabled": true
									}
								],
								"url": {
									"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/open-finance/account-information/v1.2/accounts/{{account-id}}/product",
									"protocol": "https",
									"host": [
										"rs1",
										"altareq1",
										"sandbox",
										"apihub",
										"openfinance",
										"ae"
									],
									"path": [
										"open-finance",
										"account-information",
										"v1.2",
										"accounts",
										"{{account-id}}",
										"product"
									]
								}
							},
							"response": []
						},
						{
							"name": "8007: TPP-API Hub: GET accounts/{accountId}/standing-orders",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const uuid = require('uuid');",
											"pm.environment.set(\"x-fapi-interaction-id\", uuid.v4());"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{token-from-auth-code-grant-accounts}}",
										"type": "text"
									},
									{
										"key": "x-fapi-financial-id",
										"value": "{{obParticipantId}}",
										"type": "text"
									},
									{
										"key": "x-fapi-interaction-id",
										"value": "{{x-fapi-interaction-id}}",
										"type": "text"
									},
									{
										"key": "x-fapi-auth-date",
										"value": "Sat, 15 Mar 2025 19:43:31 UTC",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-fapi-customer-ip-address",
										"value": "192.168.1.1",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-customer-user-agent",
										"value": "Chrome/114.0.5735.110",
										"type": "text",
										"disabled": true
									}
								],
								"url": {
									"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/open-finance/account-information/v1.2/accounts/{{account-id}}/standing-orders",
									"protocol": "https",
									"host": [
										"rs1",
										"altareq1",
										"sandbox",
										"apihub",
										"openfinance",
										"ae"
									],
									"path": [
										"open-finance",
										"account-information",
										"v1.2",
										"accounts",
										"{{account-id}}",
										"standing-orders"
									]
								}
							},
							"response": []
						},
						{
							"name": "8006: TPP-API Hub: GET accounts/{accountId}/scheduled-payments",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const uuid = require('uuid');",
											"pm.environment.set(\"x-fapi-interaction-id\", uuid.v4());"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{token-from-auth-code-grant-accounts}}",
										"type": "text"
									},
									{
										"key": "x-fapi-financial-id",
										"value": "{{obParticipantId}}",
										"type": "text"
									},
									{
										"key": "x-fapi-interaction-id",
										"value": "{{x-fapi-interaction-id}}",
										"type": "text"
									},
									{
										"key": "x-fapi-auth-date",
										"value": "Sat, 15 Mar 2025 19:43:31 UTC",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-fapi-customer-ip-address",
										"value": "192.168.1.1",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-customer-user-agent",
										"value": "Chrome/114.0.5735.110",
										"type": "text",
										"disabled": true
									}
								],
								"url": {
									"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/open-finance/account-information/v1.2/accounts/{{account-id}}/scheduled-payments",
									"protocol": "https",
									"host": [
										"rs1",
										"altareq1",
										"sandbox",
										"apihub",
										"openfinance",
										"ae"
									],
									"path": [
										"open-finance",
										"account-information",
										"v1.2",
										"accounts",
										"{{account-id}}",
										"scheduled-payments"
									]
								}
							},
							"response": []
						},
						{
							"name": "8005: TPP-API Hub:  GET accounts/{accountId}/beneficiaries",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const uuid = require('uuid');",
											"pm.environment.set(\"x-fapi-interaction-id\", uuid.v4());"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{token-from-auth-code-grant-accounts}}",
										"type": "text"
									},
									{
										"key": "x-fapi-financial-id",
										"value": "{{obParticipantId}}",
										"type": "text"
									},
									{
										"key": "x-fapi-interaction-id",
										"value": "{{x-fapi-interaction-id}}",
										"type": "text"
									},
									{
										"key": "x-fapi-auth-date",
										"value": "Sat, 15 Mar 2025 19:43:31 UTC",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-fapi-customer-ip-address",
										"value": "192.168.1.1",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-customer-user-agent",
										"value": "Chrome/114.0.5735.110",
										"type": "text",
										"disabled": true
									}
								],
								"url": {
									"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/open-finance/account-information/v1.2/accounts/{{account-id}}/beneficiaries",
									"protocol": "https",
									"host": [
										"rs1",
										"altareq1",
										"sandbox",
										"apihub",
										"openfinance",
										"ae"
									],
									"path": [
										"open-finance",
										"account-information",
										"v1.2",
										"accounts",
										"{{account-id}}",
										"beneficiaries"
									]
								}
							},
							"response": []
						},
						{
							"name": "8004: TPP-API Hub: GET accounts/{accountId}/direct-debits",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const uuid = require('uuid');",
											"pm.environment.set(\"x-fapi-interaction-id\", uuid.v4());"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{token-from-auth-code-grant-accounts}}",
										"type": "text"
									},
									{
										"key": "x-fapi-financial-id",
										"value": "{{obParticipantId}}",
										"type": "text"
									},
									{
										"key": "x-fapi-interaction-id",
										"value": "{{x-fapi-interaction-id}}",
										"type": "text"
									},
									{
										"key": "x-fapi-auth-date",
										"value": "Sat, 15 Mar 2025 19:43:31 UTC",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-fapi-customer-ip-address",
										"value": "192.168.1.1",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-customer-user-agent",
										"value": "Chrome/114.0.5735.110",
										"type": "text",
										"disabled": true
									}
								],
								"url": {
									"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/open-finance/account-information/v1.2/accounts/{{account-id}}/direct-debits",
									"protocol": "https",
									"host": [
										"rs1",
										"altareq1",
										"sandbox",
										"apihub",
										"openfinance",
										"ae"
									],
									"path": [
										"open-finance",
										"account-information",
										"v1.2",
										"accounts",
										"{{account-id}}",
										"direct-debits"
									]
								}
							},
							"response": []
						},
						{
							"name": "8003: TPP-API Hub: GET accounts/{accountId}/transactions",
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"exec": [
											"const uuid = require('uuid');",
											"pm.environment.set(\"x-fapi-interaction-id\", uuid.v4());"
										],
										"type": "text/javascript",
										"packages": {}
									}
								}
							],
							"request": {
								"method": "GET",
								"header": [
									{
										"key": "Content-Type",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Accept",
										"value": "application/json",
										"type": "text"
									},
									{
										"key": "Authorization",
										"value": "Bearer {{token-from-auth-code-grant-accounts}}",
										"type": "text"
									},
									{
										"key": "x-fapi-financial-id",
										"value": "{{obParticipantId}}",
										"type": "text"
									},
									{
										"key": "x-fapi-interaction-id",
										"value": "{{x-fapi-interaction-id}}",
										"type": "text"
									},
									{
										"key": "x-fapi-auth-date",
										"value": "Sat, 15 Mar 2025 19:43:31 UTC",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-fapi-customer-ip-address",
										"value": "192.168.1.1",
										"type": "text",
										"disabled": true
									},
									{
										"key": "x-customer-user-agent",
										"value": "Chrome/114.0.5735.110",
										"type": "text",
										"disabled": true
									}
								],
								"url": {
									"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/open-finance/account-information/v1.2/accounts/{{account-id}}/transactions",
									"protocol": "https",
									"host": [
										"rs1",
										"altareq1",
										"sandbox",
										"apihub",
										"openfinance",
										"ae"
									],
									"path": [
										"open-finance",
										"account-information",
										"v1.2",
										"accounts",
										"{{account-id}}",
										"transactions"
									],
									"query": [
										{
											"key": "fromBookingDateTime",
											"value": "2025-03-19T23:00:00.000Z",
											"disabled": true
										},
										{
											"key": "toBookingDateTime",
											"value": "2025-03-25T23:00:00.000Z",
											"disabled": true
										}
									]
								}
							},
							"response": []
						}
					]
				}
			]
		},
		{
			"name": "Payment Initiation",
			"item": [
				{
					"name": "Single Instant Payment",
					"item": [
						{
							"name": "AuthFlow",
							"item": [
								{
									"name": "O3 Util: Prepare Encrypted PII",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													"const CryptoJS = require('crypto-js');",
													"const uuid = require('uuid');",
													"",
													"pm.environment.set(\"exp\", Date.now() / 1000 + 300);",
													"pm.environment.set(\"nbf\", (Date.now() / 1000) - 10);",
													"",
													"const codeVerifier = uuid.v4() + uuid.v4();",
													"",
													"const hashedCodeVerifier = CryptoJS.SHA256(codeVerifier);",
													"let codeChallenge = CryptoJS.enc.Base64.stringify(hashedCodeVerifier);",
													"",
													"console.log(codeVerifier);",
													"console.log(hashedCodeVerifier);",
													"console.log(codeChallenge);",
													"",
													"codeChallenge = codeChallenge.replaceAll('+', '-');",
													"codeChallenge = codeChallenge.replaceAll('/', '_');",
													"",
													"if (codeChallenge.endsWith('=')) { codeChallenge = codeChallenge.substring(0, codeChallenge.length - 1) }",
													"",
													"console.log(codeChallenge);",
													"",
													"pm.environment.set(\"code-challenge\", codeChallenge);",
													"pm.environment.set(\"code-verifier\", codeVerifier);",
													""
												],
												"type": "text/javascript",
												"packages": {}
											}
										},
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.environment.set(\"encryptedPII\", responseBody);"
												],
												"type": "text/javascript",
												"packages": {}
											}
										}
									],
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "content-type",
												"value": "application/json"
											},
											{
												"key": "x-fapi-interaction-id",
												"value": "{{x-fapi-interaction-id}}",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"header\": {\n        \"alg\": \"PS256\",\n        \"kid\": \"{{kid-local}}\"\n    },\n    \"body\": {\n        \"aud\": \"https://auth1.altareq1.sandbox.apihub.openfinance.ae\",\n        \"exp\": {{exp}},\n        \"iss\": \"{{_clientId}}\",\n        \"sub\": \"{{_clientId}}\",\n        \"jti\": \"{{$guid}}\",\n        \"iat\": {{nbf}},\n        \"Initiation\": {\n            // \"DebtorAccount\": {\n            //     \"SchemeName\": \"IBAN\",\n            //     \"Identification\": \"10000109010102\",\n            //     \"Name\": {\n            //         \"en\": \"Luigi International\"\n            //     }\n            // },\n            \"Creditor\": [\n                {\n                    \"CreditorAgent\": {\n                        \"SchemeName\": \"BICFI\",\n                        \"Identification\": \"10000109010101\",\n                        \"Name\": \"Mario International\",\n                        \"PostalAddress\":\n                        [\n                            {\n                            \"AddressType\":\"Business\",\n                            \"Country\": \"AE\"\n                            }\n                        ]\n                    },\n                    \"Creditor\": {\n                        \"Name\": \"Mario International\"\n                    },\n                    \"CreditorAccount\": {\n                        \"SchemeName\": \"AccountNumber\",\n                        \"Identification\": \"10000109010101\",\n                        \"Name\": {\n                            \"en\": \"Mario International\"\n                        }\n                    }\n                }\n                //                 {\n                //     \"CreditorAgent\": {\n                //         \"SchemeName\": \"IBAN\",\n                //         \"Identification\": \"10000109010103\",\n                //         \"Name\": \"Mario International\"\n                //     },\n                //     \"Creditor\": {\n                //         \"Name\": \"Mario International\"\n                //     },\n                //     \"CreditorAccount\": {\n                //         \"SchemeName\": \"AccountNumber\",\n                //         \"Identification\": \"10000109010103\",\n                //         \"Name\": {\n                //             \"en\": \"Mario International\"\n                //         }\n                //     }\n                // }\n            ]\n        },\n        \"Risk\": {\n            \"DebtorIndicators\": {\n                \"UserName\": {\n                    \"en\": \"xx\"\n                } \n            },\n            \"CreditorIndicators\": {\n                \"AccountType\": \"Retail\",\n                \"IsCreditorConfirmed\": true,\n                \"IsCreditorPrePopulated\": true,\n                \"TradingName\": \"xxx\"\n            }\n        }\n    },\n    \"signingKeyPEM\": \"{{pem-local}}\",\n    \"jwksUrl\": \"{{jwksUrl}}\"\n}\n"
										},
										"url": {
											"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/o3/v1.0/message-encryption",
											"protocol": "https",
											"host": [
												"rs1",
												"altareq1",
												"sandbox",
												"apihub",
												"openfinance",
												"ae"
											],
											"path": [
												"o3",
												"v1.0",
												"message-encryption"
											]
										}
									},
									"response": []
								},
								{
									"name": "O3 Util: Prepare request object JWT for PAR end-point",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													"pm.environment.set(\"exp\", Date.now() / 1000 + 300);",
													"pm.environment.set(\"nbf\", (Date.now() / 1000) - 10);",
													"pm.environment.set(\"today\", new Date().toISOString().split('T')[0]);",
													"",
													"const uuid = require('uuid');",
													"",
													"const codeVerifier = uuid.v4() + uuid.v4();",
													"",
													"pm.environment.set('service-initiation-consent-id', uuid.v4())",
													"",
													"const hashedCodeVerifier = CryptoJS.SHA256(codeVerifier);",
													"let codeChallenge = CryptoJS.enc.Base64.stringify(hashedCodeVerifier);",
													"",
													"console.log(codeVerifier);",
													"console.log(hashedCodeVerifier);",
													"console.log(codeChallenge);",
													"codeChallenge = codeChallenge.replaceAll('+', '-');",
													"codeChallenge = codeChallenge.replaceAll('/', '_');",
													"if (codeChallenge.endsWith('=')) { codeChallenge = codeChallenge.substring(0, codeChallenge.length - 1)}",
													"console.log(codeChallenge);",
													"",
													"pm.environment.set(\"code-challenge\", codeChallenge );",
													"pm.environment.set(\"code-verifier\", codeVerifier );"
												],
												"type": "text/javascript",
												"packages": {}
											}
										},
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.environment.set(\"requestObject\", responseBody);",
													"",
													"var a = responseBody.split('.');",
													"var words = CryptoJS.enc.Base64.parse(a[1]);",
													"var bodyData = CryptoJS.enc.Utf8.stringify(words);",
													"console.log(bodyData);",
													"var jsonData = JSON.parse(bodyData);",
													"console.log(jsonData);",
													"",
													"pm.environment.set(\"response_type\", jsonData.response_type);",
													"pm.environment.set(\"scope\", jsonData.scope);",
													"",
													"pm.environment.set(\"service-initiation-base-consent-id\", jsonData.authorization_details[0].consent.ConsentId);",
													"pm.environment.set(\"service-initiation-consent-id\", jsonData.authorization_details[0].consent.ConsentId);"
												],
												"type": "text/javascript",
												"packages": {}
											}
										}
									],
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "content-type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"header\": {\n        \"alg\": \"PS256\",\n        \"kid\": \"{{kid-local}}\"\n    },\n    \"body\": {\n        \"aud\": \"https://auth1.altareq1.sandbox.apihub.openfinance.ae\",\n        \"exp\": {{exp}},\n        \"iss\": \"{{_clientId}}\",\n        \"scope\": \"payments openid\",\n        \"redirect_uri\": \"https://ob-testing.onrender.com/callback\",\n        \"client_id\": \"{{_clientId}}\",\n        \"nonce\": \"{{$guid}}\",\n        \"state\": \"{{$guid}}\",\n        \"nbf\": {{nbf}},\n        \"response_type\": \"code\",\n        \"code_challenge_method\": \"S256\",\n        \"code_challenge\": \"{{code-challenge}}\",\n        \"max_age\": 3600,\n        \"authorization_details\": [\n            {\n                \"type\": \"urn:openfinanceuae:service-initiation-consent:v1.2\",\n                \"consent\": {\n                    \"ConsentId\": \"{{service-initiation-consent-id}}\",\n                    \"IsSingleAuthorization\": true,\n                    \"ExpirationDateTime\": \"{{today}}T23:00:00.000Z\",\n                    \"PersonalIdentifiableInformation\": \"{{encryptedPII}}\",\n                    \"Permissions\": [\"ReadRefundAccount\"],\n                    \"ControlParameters\": {\n                        \"ConsentSchedule\": {\n                            \"SinglePayment\": {\n                                \"Type\": \"SingleInstantPayment\",\n                                \"Amount\": {\n                                    \"Amount\": \"150.00\",\n                                    \"Currency\": \"AED\"\n                                }\n                            }\n                        }\n                    },\n                    \"PaymentPurposeCode\": \"ACM\"\n                },\n                \"subscription\": {\n                    \"Webhook\": {\n                        \"Url\": \"http://localhost:4700/mock-event-receiver\",\n                        \"IsActive\": false\n                    }\n                }\n            }\n        ]\n    },\n    \"signingKeyPEM\": \"{{pem-local}}\"\n}"
										},
										"url": {
											"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/o3/v1.0/message-signature",
											"protocol": "https",
											"host": [
												"rs1",
												"altareq1",
												"sandbox",
												"apihub",
												"openfinance",
												"ae"
											],
											"path": [
												"o3",
												"v1.0",
												"message-signature"
											]
										}
									},
									"response": []
								},
								{
									"name": "O3 Util: Prepare private key JWT for PAR end-point",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													"pm.environment.set(\"exp\", Date.now() / 1000 + 300);",
													"pm.environment.set(\"nbf\", (Date.now() / 1000) - 10);",
													"",
													"const uuid = require('uuid');",
													""
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.environment.set(\"private_key_jwt\", responseBody);"
												],
												"type": "text/javascript"
											}
										}
									],
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "content-type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"header\": {\n        \"alg\": \"PS256\",\n        \"kid\": \"{{kid-local}}\"\n    },\n    \"body\": {\n        \"aud\": \"https://auth1.altareq1.sandbox.apihub.openfinance.ae\",\n        \"exp\": {{exp}},\n        \"iss\": \"{{_clientId}}\",\n        \"sub\": \"{{_clientId}}\",\n        \"jti\": \"{{$guid}}\",\n        \"iat\": {{nbf}}\n    },\n    \"signingKeyPEM\": \"{{pem-local}}\"\n}"
										},
										"url": {
											"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/o3/v1.0/message-signature",
											"protocol": "https",
											"host": [
												"rs1",
												"altareq1",
												"sandbox",
												"apihub",
												"openfinance",
												"ae"
											],
											"path": [
												"o3",
												"v1.0",
												"message-signature"
											]
										}
									},
									"response": []
								},
								{
									"name": "4000: TPP-API Hub: POST to PAR end-point",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"let jsonData = JSON.parse(pm.response.text());",
													"",
													"pm.environment.set(\"par-urn\", jsonData.request_uri);",
													"",
													"const clientId = pm.environment.get(\"_clientId\");",
													"const authEndpoint = pm.environment.get('auth-endpoint');",
													"const response_type = pm.environment.get('response_type');",
													"const authCodeUrl = `${authEndpoint}?client_id=${clientId}&response_type=${response_type}&scope=openid&request_uri=${jsonData.request_uri}`;",
													"",
													"pm.environment.set(\"authCodeUrl\", authCodeUrl);",
													"",
													"",
													"var myUrl = utils.splitAndEncodeURL(authCodeUrl)",
													"var template = utils.visualizer.qrTemplate1();",
													"var data = utils.visualizer.qrData(myUrl);",
													"",
													"utils.visualizer.draw(pm.visualizer, template, {",
													"    response: data",
													"})",
													"",
													"",
													"// encode the url ",
													"var responseBody = authCodeUrl.replace('adcb://uat.mib.pn/auth', pm.environment.get('authEndpoint'))",
													"pm.environment.set(\"authCodeUrl\", responseBody);",
													""
												],
												"type": "text/javascript",
												"packages": {}
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													""
												],
												"type": "text/javascript",
												"packages": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/x-www-form-urlencoded",
												"type": "text"
											},
											{
												"key": "x-cert-dn",
												"value": "CN=e14a49e6-8ad4-4dcf-bd2e-85a38fe8752c,OU=233bcd1d-4216-4b3c-a362-9e4a9282bba7,O=RAIDIAM SERVICES LIMITED,C=UK",
												"type": "text",
												"disabled": true
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "client_id",
													"value": "{{_clientId}}",
													"type": "text"
												},
												{
													"key": "request",
													"value": "{{requestObject}}",
													"type": "default"
												},
												{
													"key": "client_assertion_type",
													"value": "urn:ietf:params:oauth:client-assertion-type:jwt-bearer",
													"type": "text"
												},
												{
													"key": "client_assertion",
													"value": "{{private_key_jwt}}",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "https://as1.altareq1.sandbox.apihub.openfinance.ae/par",
											"protocol": "https",
											"host": [
												"as1",
												"altareq1",
												"sandbox",
												"apihub",
												"openfinance",
												"ae"
											],
											"path": [
												"par"
											]
										}
									},
									"response": []
								},
								{
									"name": "7002: TPP-API Hub: Auth Code Grant",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"let jsonData = JSON.parse(responseBody);",
													"pm.environment.set(\"token-from-auth-code-grant-payments\", jsonData.access_token);",
													"pm.environment.set(\"refresh_token\", jsonData.refresh_token);"
												],
												"type": "text/javascript",
												"packages": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/x-www-form-urlencoded",
												"type": "text"
											},
											{
												"key": "x-cert-dn",
												"value": "CN=e14a49e6-8ad4-4dcf-bd2e-85a38fe8752c,OU=233bcd1d-4216-4b3c-a362-9e4a9282bba7,O=RAIDIAM SERVICES LIMITED,C=UK",
												"type": "text",
												"disabled": true
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "authorization_code",
													"type": "text"
												},
												{
													"key": "code",
													"value": "{{authorizationCode}}",
													"type": "text"
												},
												{
													"key": "redirect_uri",
													"value": "https://ob-testing.onrender.com/callback",
													"type": "text"
												},
												{
													"key": "code_verifier",
													"value": "{{code-verifier}}",
													"type": "default"
												},
												{
													"key": "client_assertion_type",
													"value": "urn:ietf:params:oauth:client-assertion-type:jwt-bearer",
													"type": "text"
												},
												{
													"key": "client_assertion",
													"value": "{{private_key_jwt}}",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "https://as1.altareq1.sandbox.apihub.openfinance.ae/token",
											"protocol": "https",
											"host": [
												"as1",
												"altareq1",
												"sandbox",
												"apihub",
												"openfinance",
												"ae"
											],
											"path": [
												"token"
											]
										},
										"description": "Copy the authorization code generated into the browser into the **Body** tab in the `code` parameter"
									},
									"response": []
								}
							],
							"event": [
								{
									"listen": "prerequest",
									"script": {
										"type": "text/javascript",
										"exec": [
											""
										]
									}
								},
								{
									"listen": "test",
									"script": {
										"type": "text/javascript",
										"exec": [
											""
										]
									}
								}
							]
						},
						{
							"name": "TPP",
							"item": [
								{
									"name": "O3 Util: Prepare Encrypted PII -Post payment",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													"const CryptoJS = require('crypto-js');",
													"const uuid = require('uuid');",
													"",
													"pm.environment.set(\"exp\", Date.now() / 1000 + 300);",
													"pm.environment.set(\"nbf\", (Date.now() / 1000) - 10);",
													"",
													"const codeVerifier = uuid.v4() + uuid.v4();",
													"",
													"const hashedCodeVerifier = CryptoJS.SHA256(codeVerifier);",
													"let codeChallenge = CryptoJS.enc.Base64.stringify(hashedCodeVerifier);",
													"",
													"console.log(codeVerifier);",
													"console.log(hashedCodeVerifier);",
													"console.log(codeChallenge);",
													"",
													"codeChallenge = codeChallenge.replaceAll('+', '-');",
													"codeChallenge = codeChallenge.replaceAll('/', '_');",
													"",
													"if (codeChallenge.endsWith('=')) { codeChallenge = codeChallenge.substring(0, codeChallenge.length - 1) }",
													"",
													"console.log(codeChallenge);",
													"",
													"pm.environment.set(\"code-challenge\", codeChallenge);",
													"pm.environment.set(\"code-verifier\", codeVerifier);",
													""
												],
												"type": "text/javascript",
												"packages": {}
											}
										},
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.environment.set(\"encryptedPII-payment\", responseBody);"
												],
												"type": "text/javascript",
												"packages": {}
											}
										}
									],
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "content-type",
												"value": "application/json"
											},
											{
												"key": "x-fapi-interaction-id",
												"value": "{{x-fapi-interaction-id}}",
												"type": "text"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"header\": {\n        \"alg\": \"PS256\",\n        \"kid\": \"{{kid-local}}\"\n    },\n    \"body\": {\n        \"aud\": \"https://auth1.altareq1.sandbox.apihub.openfinance.ae\",\n        \"exp\": {{exp}},\n        \"iss\": \"{{_clientId}}\",\n        \"sub\": \"{{_clientId}}\",\n        \"jti\": \"{{$guid}}\",\n        \"iat\": {{nbf}},\n        \"Initiation\": {\n            \"CreditorAgent\": {\n                \"SchemeName\": \"BICFI\",\n                \"Identification\": \"10000109010101\",\n                \"Name\": \"Mario International\",\n                \"PostalAddress\":\n                        [\n                            {\n                            \"AddressType\":\"Business\",\n                            \"Country\": \"AE\"\n                            }\n                        ]\n            },\n            \"Creditor\": {\n                \"Name\": \"Mario International\"\n            },\n            \"CreditorAccount\": {\n                \"SchemeName\": \"AccountNumber\",\n                \"Identification\": \"10000109010101\",\n                \"Name\": {\n                    \"en\": \"Mario International\"\n                }\n            }\n        },\n        \"Risk\": {\n            \"DebtorIndicators\": {\n                \"UserName\": {\n                    \"en\": \"xx\"\n                }\n            },\n            \"CreditorIndicators\": {\n                \"AccountType\": \"Retail\",\n                \"IsCreditorConfirmed\": true,\n                \"IsCreditorPrePopulated\": true,\n                \"TradingName\": \"xxx\"\n            }\n        }\n    },\n    \"signingKeyPEM\": \"{{pem-local}}\",\n    \"jwksUrl\": \"{{jwksUrl}}\"\n}"
										},
										"url": {
											"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/o3/v1.0/message-encryption",
											"protocol": "https",
											"host": [
												"rs1",
												"altareq1",
												"sandbox",
												"apihub",
												"openfinance",
												"ae"
											],
											"path": [
												"o3",
												"v1.0",
												"message-encryption"
											]
										}
									},
									"response": []
								},
								{
									"name": "O3 Util: Prepare request object JWT for Single Instant Payment",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													"const uuid = require('uuid');",
													"pm.environment.set(\"x-fapi-interaction-id\", uuid.v4());",
													"const now = Math.floor(Date.now() / 1000);",
													"const data1 = JSON.stringify({",
													"    \"aud\": [pm.environment.get(\"issuer\")],",
													"    \"iss\": pm.environment.get(\"_clientId\"),",
													"    \"iat\": now,",
													"    \"exp\": now + now,",
													"    \"nbf\": 0,",
													"    \"message\": {",
													"        \"Data\": {",
													"            \"ConsentId\":",
													"                pm.environment.get(\"service-initiation-consent-id\"),",
													"            \"Instruction\": {",
													"                \"Amount\": {",
													"                    \"Amount\": \"150.00\",",
													"                    \"Currency\": \"AED\"",
													"                }",
													"            },",
													"            \"OpenFinanceBilling\": {",
													"                \"Type\": \"Collection\"",
													"            },",
													"            \"PersonalIdentifiableInformation\": pm.environment.get('encryptedPII-payment'),",
													"            \"PaymentPurposeCode\": \"ACM\",",
													"            \"DebtorReference\": \"TPP=a06154a7-fcb0-0472-be1c-21c8e5a74b6a,BIC=QW292P4TW8T\",",
													"            \"CreditorReference\": \"TPP=a06154a7-fcb0-0472-be1c-21c8e5a74b6a,BIC=QW292P4TW8T\"",
													"        }",
													"    }",
													"}",
													");",
													"pm.environment.set(\"data\", data1);"
												],
												"type": "text/javascript",
												"packages": {}
											}
										},
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.environment.set(\"pis_request_body_jwt\", responseBody);"
												],
												"type": "text/javascript",
												"packages": {}
											}
										}
									],
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "content-type",
												"value": "application/json"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"header\": {\n        \"alg\": \"PS256\",\n        \"kid\": \"{{kid-local}}\"\n    },\n    \"body\": {{data}},\n    \"signingKeyPEM\": \"{{pem-local}}\"\n}"
										},
										"url": {
											"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/o3/v1.0/message-signature",
											"protocol": "https",
											"host": [
												"rs1",
												"altareq1",
												"sandbox",
												"apihub",
												"openfinance",
												"ae"
											],
											"path": [
												"o3",
												"v1.0",
												"message-signature"
											]
										}
									},
									"response": []
								},
								{
									"name": "1002: O3 Util: Prepare private key JWT",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													"pm.environment.set(\"exp\", Date.now() / 1000 + 300);",
													"pm.environment.set(\"nbf\", (Date.now() / 1000) - 10);",
													"const uuid = require('uuid');"
												],
												"type": "text/javascript"
											}
										},
										{
											"listen": "test",
											"script": {
												"exec": [
													"pm.environment.set(\"private_key_jwt\", responseBody);"
												],
												"type": "text/javascript"
											}
										}
									],
									"protocolProfileBehavior": {
										"disableBodyPruning": true
									},
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "content-type",
												"value": "application/json",
												"type": "default"
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{\n    \"header\": {\n        \"alg\": \"PS256\",\n        \"kid\": \"{{kid-local}}\"\n    },\n    \"body\": {\n        \"aud\": \"https://auth1.altareq1.sandbox.apihub.openfinance.ae\",\n        \"exp\": {{exp}},\n        \"iss\": \"{{_clientId}}\",\n        \"sub\": \"{{_clientId}}\",\n        \"jti\": \"{{$guid}}\",\n        \"iat\": {{nbf}}\n    },\n    \"signingKeyPEM\": \"{{pem-local}}\"\n}"
										},
										"url": {
											"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/o3/v1.0/message-signature",
											"protocol": "https",
											"host": [
												"rs1",
												"altareq1",
												"sandbox",
												"apihub",
												"openfinance",
												"ae"
											],
											"path": [
												"o3",
												"v1.0",
												"message-signature"
											]
										}
									},
									"response": []
								},
								{
									"name": "8000: TPP-Hub: POST payment",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"var a = responseBody.split('.');",
													"var words = CryptoJS.enc.Base64.parse(a[1]);",
													"var bodyData = CryptoJS.enc.Utf8.stringify(words);",
													"var jsonData = JSON.parse(bodyData);",
													"pm.environment.set(\"paymentId\", jsonData.message.Data.PaymentId);"
												],
												"type": "text/javascript",
												"packages": {}
											}
										},
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													"// const xIdempotencyKey = $guid;",
													"// console.log(`${xIdempotencyKey}`);",
													"",
													"var uuid = require('uuid');",
													"",
													"pm.environment.set(\"x-idempotency-key\", uuid.v4());",
													"console.log(`${pm.environment.get('x-idempotency-key')}`);"
												],
												"type": "text/javascript",
												"packages": {}
											}
										}
									],
									"protocolProfileBehavior": {
										"followOriginalHttpMethod": false
									},
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/jwt",
												"type": "text"
											},
											{
												"key": "x-fapi-financial-id",
												"value": "{{obParticipantId}}",
												"type": "text"
											},
											{
												"key": "x-fapi-customer-ip-address",
												"value": "10.1.1.10",
												"type": "text"
											},
											{
												"key": "x-fapi-interaction-id",
												"value": "{{x-fapi-interaction-id}}",
												"type": "text"
											},
											{
												"key": "Authorization",
												"value": "Bearer {{token-from-auth-code-grant-payments}}",
												"type": "text"
											},
											{
												"key": "x-idempotency-key",
												"value": "{{x-idempotency-key}}",
												"type": "text"
											},
											{
												"key": "x-fapi-auth-date",
												"value": "Sat, 15 Mar 2025 19:43:31 UTC",
												"type": "text",
												"disabled": true
											},
											{
												"key": "x-customer-user-agent",
												"value": "Chrome/114.0.5735.110",
												"type": "text",
												"disabled": true
											}
										],
										"body": {
											"mode": "raw",
											"raw": "{{pis_request_body_jwt}}",
											"options": {
												"raw": {
													"language": "json"
												}
											}
										},
										"url": {
											"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/open-finance/payment/v1.2/payments",
											"protocol": "https",
											"host": [
												"rs1",
												"altareq1",
												"sandbox",
												"apihub",
												"openfinance",
												"ae"
											],
											"path": [
												"open-finance",
												"payment",
												"v1.2",
												"payments"
											]
										}
									},
									"response": []
								},
								{
									"name": "9004: TPP-API Hub: GET payment by id",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													"// set uuid and time",
													"pm.environment.set(\"now\", (new Date()).toUTCString());",
													"const uuid = require('uuid');",
													"pm.environment.set(\"x-fapi-interaction-id\", uuid.v4());"
												],
												"type": "text/javascript",
												"packages": {}
											}
										}
									],
									"protocolProfileBehavior": {
										"followOriginalHttpMethod": false
									},
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/jwt",
												"type": "text"
											},
											{
												"key": "x-fapi-financial-id",
												"value": "{{obParticipantId}}",
												"type": "text"
											},
											{
												"key": "x-fapi-customer-ip-address",
												"value": "10.1.1.10",
												"type": "text"
											},
											{
												"key": "x-fapi-interaction-id",
												"value": "{{x-fapi-interaction-id}}",
												"type": "text"
											},
											{
												"key": "Authorization",
												"value": "Bearer {{token-from-client-credentials-grant-private-key-jwt}}",
												"type": "text"
											},
											{
												"key": "x-fapi-auth-date",
												"value": "Sat, 15 Mar 2025 19:43:31 UTC",
												"type": "text",
												"disabled": true
											},
											{
												"key": "x-customer-user-agent",
												"value": "Chrome/114.0.5735.110",
												"type": "text",
												"disabled": true
											}
										],
										"url": {
											"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/open-finance/payment/v1.2/payments/{{paymentId}}",
											"protocol": "https",
											"host": [
												"rs1",
												"altareq1",
												"sandbox",
												"apihub",
												"openfinance",
												"ae"
											],
											"path": [
												"open-finance",
												"payment",
												"v1.2",
												"payments",
												"{{paymentId}}"
											]
										}
									},
									"response": []
								},
								{
									"name": "1003: TPP-O3: Client Credential Grant",
									"event": [
										{
											"listen": "test",
											"script": {
												"exec": [
													"let jsonData = JSON.parse(responseBody);",
													"pm.environment.set(\"token-from-client-credentials-grant-private-key-jwt\", jsonData.access_token);",
													"pm.environment.set(\"refresh_token\", jsonData.refresh_token);"
												],
												"type": "text/javascript",
												"packages": {}
											}
										}
									],
									"request": {
										"method": "POST",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/x-www-form-urlencoded",
												"type": "text"
											},
											{
												"key": "x-cert-dn",
												"value": "CN=e14a49e6-8ad4-4dcf-bd2e-85a38fe8752c,OU=233bcd1d-4216-4b3c-a362-9e4a9282bba7,O=RAIDIAM SERVICES LIMITED,C=UK",
												"type": "text",
												"disabled": true
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": [
												{
													"key": "grant_type",
													"value": "client_credentials",
													"type": "text"
												},
												{
													"key": "scope",
													"value": "openid payments",
													"type": "text"
												},
												{
													"key": "code",
													"value": "{{authorizationCode}}",
													"type": "text",
													"disabled": true
												},
												{
													"key": "redirect_uri",
													"value": "https://ob-testing.onrender.com/callback",
													"type": "text",
													"disabled": true
												},
												{
													"key": "code_verifier",
													"value": "{{code-verifier}}",
													"type": "default",
													"disabled": true
												},
												{
													"key": "client_assertion_type",
													"value": "urn:ietf:params:oauth:client-assertion-type:jwt-bearer",
													"type": "text"
												},
												{
													"key": "client_assertion",
													"value": "{{private_key_jwt}}",
													"type": "text"
												}
											]
										},
										"url": {
											"raw": "https://as1.altareq1.sandbox.apihub.openfinance.ae/token",
											"protocol": "https",
											"host": [
												"as1",
												"altareq1",
												"sandbox",
												"apihub",
												"openfinance",
												"ae"
											],
											"path": [
												"token"
											]
										},
										"description": "Copy the authorization code generated into the browser into the **Body** tab in the `code` parameter"
									},
									"response": []
								},
								{
									"name": "xxxx: TPP-API Hub: GET payment by xIdempotencyKey",
									"event": [
										{
											"listen": "prerequest",
											"script": {
												"exec": [
													"// set uuid and time",
													"pm.environment.set(\"now\", (new Date()).toUTCString());",
													"const uuid = require('uuid');",
													"pm.environment.set(\"x-fapi-interaction-id\", uuid.v4());"
												],
												"type": "text/javascript",
												"packages": {}
											}
										}
									],
									"protocolProfileBehavior": {
										"followOriginalHttpMethod": false,
										"disableBodyPruning": true
									},
									"request": {
										"method": "GET",
										"header": [
											{
												"key": "Content-Type",
												"value": "application/jwt",
												"type": "text"
											},
											{
												"key": "x-fapi-financial-id",
												"value": "{{obParticipantId}}",
												"type": "text"
											},
											{
												"key": "x-fapi-customer-ip-address",
												"value": "10.1.1.10",
												"type": "text"
											},
											{
												"key": "x-fapi-interaction-id",
												"value": "{{x-fapi-interaction-id}}",
												"type": "text"
											},
											{
												"key": "Authorization",
												"value": "Bearer {{token-from-client-credentials-grant-private-key-jwt}}",
												"type": "text"
											},
											{
												"key": "x-idempotency-key",
												"value": "{{x-idempotency-key}}",
												"type": "text"
											},
											{
												"key": "x-fapi-auth-date",
												"value": "Sat, 15 Mar 2025 19:43:31 UTC",
												"type": "text",
												"disabled": true
											},
											{
												"key": "x-customer-user-agent",
												"value": "Chrome/114.0.5735.110",
												"type": "text",
												"disabled": true
											}
										],
										"body": {
											"mode": "urlencoded",
											"urlencoded": []
										},
										"url": {
											"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/open-finance/payment/v1.2/payments",
											"protocol": "https",
											"host": [
												"rs1",
												"altareq1",
												"sandbox",
												"apihub",
												"openfinance",
												"ae"
											],
											"path": [
												"open-finance",
												"payment",
												"v1.2",
												"payments"
											]
										}
									},
									"response": []
								}
							]
						}
					]
				}
			]
		},
		{
			"name": "Open Product API",
			"item": [
				{
					"name": "1002: O3 Util: Prepare private key JWT",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.environment.set(\"exp\", Date.now() / 1000 + 300);",
									"pm.environment.set(\"nbf\", (Date.now() / 1000) - 10);",
									"const uuid = require('uuid');"
								],
								"type": "text/javascript"
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.environment.set(\"private_key_jwt\", responseBody);"
								],
								"type": "text/javascript"
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "content-type",
								"value": "application/json",
								"type": "default"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"header\": {\n        \"alg\": \"PS256\",\n        \"kid\": \"{{kid-local}}\"\n    },\n    \"body\": {\n        \"aud\": \"https://auth1.altareq1.sandbox.apihub.openfinance.ae\",\n        \"exp\": {{exp}},\n        \"iss\": \"{{_clientId}}\",\n        \"sub\": \"{{_clientId}}\",\n        \"jti\": \"{{$guid}}\",\n        \"iat\": {{nbf}}\n    },\n    \"signingKeyPEM\": \"{{pem-local}}\"\n}"
						},
						"url": {
							"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/o3/v1.0/message-signature",
							"protocol": "https",
							"host": [
								"rs1",
								"altareq1",
								"sandbox",
								"apihub",
								"openfinance",
								"ae"
							],
							"path": [
								"o3",
								"v1.0",
								"message-signature"
							]
						}
					},
					"response": []
				},
				{
					"name": "1003: TPP-O3: Client Credential Grant",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"let jsonData = JSON.parse(responseBody);",
									"pm.environment.set(\"token-from-client-credentials-grant-private-key-jwt\", jsonData.access_token);",
									"pm.environment.set(\"refresh_token\", jsonData.refresh_token);"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							},
							{
								"key": "x-cert-dn",
								"value": "CN=e14a49e6-8ad4-4dcf-bd2e-85a38fe8752c,OU=233bcd1d-4216-4b3c-a362-9e4a9282bba7,O=RAIDIAM SERVICES LIMITED,C=UK",
								"type": "text",
								"disabled": true
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "client_credentials",
									"type": "text"
								},
								{
									"key": "scope",
									"value": "openid products",
									"type": "text"
								},
								{
									"key": "code",
									"value": "{{authorizationCode}}",
									"type": "text",
									"disabled": true
								},
								{
									"key": "redirect_uri",
									"value": "https://ob-testing.onrender.com/callback",
									"type": "text",
									"disabled": true
								},
								{
									"key": "code_verifier",
									"value": "{{code-verifier}}",
									"type": "default",
									"disabled": true
								},
								{
									"key": "client_assertion_type",
									"value": "urn:ietf:params:oauth:client-assertion-type:jwt-bearer",
									"type": "text"
								},
								{
									"key": "client_assertion",
									"value": "{{private_key_jwt}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "https://as1.altareq1.sandbox.apihub.openfinance.ae/token",
							"protocol": "https",
							"host": [
								"as1",
								"altareq1",
								"sandbox",
								"apihub",
								"openfinance",
								"ae"
							],
							"path": [
								"token"
							]
						},
						"description": "Copy the authorization code generated into the browser into the **Body** tab in the `code` parameter"
					},
					"response": []
				},
				{
					"name": "1004: TPP-API GET Product",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"",
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"// set uuid and time",
									"pm.environment.set(\"now\", (new Date()).toUTCString());",
									"const uuid = require('uuid');",
									"pm.environment.set(\"x-fapi-interaction-id\", uuid.v4());"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"auth": {
							"type": "noauth"
						},
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token-from-client-credentials-grant-private-key-jwt}}"
							},
							{
								"key": "x-fapi-interaction-id",
								"value": "{{x-fapi-interaction-id}}"
							},
							{
								"key": "ProductCategory",
								"value": "SavingsAccount",
								"type": "text",
								"disabled": true
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": []
						},
						"url": {
							"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/open-finance/product/v1.2/products",
							"protocol": "https",
							"host": [
								"rs1",
								"altareq1",
								"sandbox",
								"apihub",
								"openfinance",
								"ae"
							],
							"path": [
								"open-finance",
								"product",
								"v1.2",
								"products"
							],
							"query": [
								{
									"key": "ProductCategory",
									"value": "CreditCard",
									"disabled": true
								}
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Confirmation Of Payee APIs (application/jwt)",
			"item": [
				{
					"name": "O3 Util: Prepare private key JWT",
					"event": [
						{
							"listen": "prerequest",
							"script": {
								"exec": [
									"pm.environment.set(\"exp\", Date.now() / 1000 + 300);",
									"pm.environment.set(\"nbf\", (Date.now() / 1000) - 10);",
									"const uuid = require('uuid');"
								],
								"type": "text/javascript",
								"packages": {}
							}
						},
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.environment.set(\"private_key_jwt\", responseBody);"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "content-type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"header\": {\n        \"alg\": \"PS256\",\n        \"kid\": \"{{kid-local}}\"\n    },\n    \"body\": {\n        \"aud\": \"https://auth1.altareq1.sandbox.apihub.openfinance.ae\",\n        \"exp\": {{exp}},\n        \"iss\": \"{{_clientId}}\",\n        \"sub\": \"{{_clientId}}\",\n        \"jti\": \"{{$guid}}\",\n        \"iat\": {{nbf}}\n    },\n    \"signingKeyPEM\": \"{{pem-local}}\"\n}"
						},
						"url": {
							"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/o3/v1.0/message-signature",
							"protocol": "https",
							"host": [
								"rs1",
								"altareq1",
								"sandbox",
								"apihub",
								"openfinance",
								"ae"
							],
							"path": [
								"o3",
								"v1.0",
								"message-signature"
							]
						}
					},
					"response": []
				},
				{
					"name": "xxxx: TPP-O3: Client Credential Grant - AuthServer",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"let jsonData = JSON.parse(responseBody);",
									"pm.environment.set(\"token-from-client-credentials-grant-metrics\", jsonData.access_token);",
									"pm.environment.set(\"refresh_token\", jsonData.refresh_token);"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/x-www-form-urlencoded",
								"type": "text"
							},
							{
								"key": "x-cert-dn",
								"value": "CN=e14a49e6-8ad4-4dcf-bd2e-85a38fe8752c,OU=233bcd1d-4216-4b3c-a362-9e4a9282bba7,O=RAIDIAM SERVICES LIMITED,C=UK",
								"type": "text",
								"disabled": true
							}
						],
						"body": {
							"mode": "urlencoded",
							"urlencoded": [
								{
									"key": "grant_type",
									"value": "client_credentials",
									"type": "text"
								},
								{
									"key": "scope",
									"value": "confirmation-of-payee",
									"type": "text"
								},
								{
									"key": "code",
									"value": "{{authorizationCode}}",
									"type": "text",
									"disabled": true
								},
								{
									"key": "redirect_uri",
									"value": "https://ob-testing.onrender.com/callback",
									"type": "text",
									"disabled": true
								},
								{
									"key": "code_verifier",
									"value": "{{code-verifier}}",
									"type": "default",
									"disabled": true
								},
								{
									"key": "client_assertion_type",
									"value": "urn:ietf:params:oauth:client-assertion-type:jwt-bearer",
									"type": "text"
								},
								{
									"key": "client_assertion",
									"value": "{{private_key_jwt}}",
									"type": "text"
								}
							]
						},
						"url": {
							"raw": "{{discovered-as}}/token",
							"host": [
								"{{discovered-as}}"
							],
							"path": [
								"token"
							]
						},
						"description": "Copy the authorization code generated into the browser into the **Body** tab in the `code` parameter"
					},
					"response": []
				},
				{
					"name": "Step 1_A Sign GET /confirmation",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.environment.set(\"signedPostCopDiscoveryJwt\", responseBody);"
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"protocolProfileBehavior": {
						"disableBodyPruning": true
					},
					"request": {
						"method": "GET",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							},
							{
								"key": "Accept",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"header\": {\n        \"alg\": \"PS256\",\n        \"kid\": \"{{kid-local}}\"\n    },\n    \"body\": {\n        \"iss\": \"{{_clientId}}\",\n        \"exp\": {{exp}},\n        \"nbf\": {{nbf}},\n        \"aud\": \"https://auth1.altareq1.sandbox.apihub.openfinance.ae\",\n        \"iat\": {{nbf}},\n        \"message\": {\n            \"Data\": {\n                \"SchemeName\": \"IBAN\",\n                \"Identification\": \"AE070331234567890123456\",\n                \"Name\": {\n                    \"FullName\": \"Ibrahim Al Suwaidi\",\n                    \"GivenName\": \"Al Suwaidi\",\n                    \"LastName\": \"Ibrahim\"\n                    // \"BusinessName\": \"Business Inc.\"\n                }\n            }\n        }\n    },\n    \"signingKeyPEM\": \"{{pem-local}}\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "https://rs1.altareq1.sandbox.apihub.openfinance.ae/o3/v1.0/message-signature",
							"protocol": "https",
							"host": [
								"rs1",
								"altareq1",
								"sandbox",
								"apihub",
								"openfinance",
								"ae"
							],
							"path": [
								"o3",
								"v1.0",
								"message-signature"
							]
						}
					},
					"response": []
				},
				{
					"name": "Step 1_B: POST /confirmation",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									""
								],
								"type": "text/javascript",
								"packages": {}
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/jwt",
								"type": "text"
							},
							{
								"key": "Authorization",
								"value": "Bearer {{token-from-client-credentials-grant-metrics}}",
								"type": "text"
							},
							{
								"key": "Accept",
								"value": "application/jwt",
								"type": "text"
							},
							{
								"key": "x-fapi-auth-date",
								"value": "Sat, 15 Mar 2025 19:43:31 UTC",
								"type": "text",
								"disabled": true
							},
							{
								"key": "x-fapi-customer-ip-address",
								"value": "192.168.1.1",
								"type": "text",
								"disabled": true
							},
							{
								"key": "x-customer-user-agent",
								"value": "Chrome/114.0.5735.110",
								"type": "text",
								"disabled": true
							},
							{
								"key": "x-fapi-interaction-id",
								"value": "{{x-fapi-interaction-id}}",
								"type": "text"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{{signedPostCopDiscoveryJwt}}",
							"options": {
								"raw": {
									"language": "text"
								}
							}
						},
						"url": {
							"raw": "{{discovered-rs}}/open-finance/confirmation-of-payee/v1.2/confirmation",
							"host": [
								"{{discovered-rs}}"
							],
							"path": [
								"open-finance",
								"confirmation-of-payee",
								"v1.2",
								"confirmation"
							]
						}
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"exec": [
					"const uuid = require('uuid');",
					"pm.environment.set(\"x-fapi-interaction-id\", uuid.v4());"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"packages": {},
				"exec": [
					"const uuid = require('uuid');",
					"",
					"function isValidJwt(token) {",
					"    return /^[A-Za-z0-9_-]+\\.[A-Za-z0-9_-]+\\.[A-Za-z0-9_-]+$/.test(token);",
					"}",
					"",
					"function parseJwt(token, part) {",
					"    var base64Url = token.split('.')[part];",
					"    var words = CryptoJS.enc.Base64.parse(base64Url);",
					"    var jsonPayload = CryptoJS.enc.Utf8.stringify(words);",
					"    return JSON.parse(jsonPayload);",
					"}",
					"",
					"function processJwtObject(obj) {",
					"    for (var key in obj) {",
					"        if (typeof obj[key] === 'object' && obj[key] !== null) {",
					"            obj[key] = JSON.stringify(obj[key], null, 2); // Format JSON with indentation if it's an object",
					"        }",
					"    }",
					"    return obj;",
					"}",
					"",
					"if (isValidJwt(responseBody)) {",
					"    console.log('Valid JWT')",
					"    var jwtInfo = {};",
					"    jwtInfo.size = responseBody.length;",
					"    jwtInfo.header = processJwtObject(parseJwt(responseBody, 0));",
					"    jwtInfo.payload = processJwtObject(parseJwt(responseBody, 1));",
					"    jwtInfo.signature = responseBody.split('.')[2];",
					"    jwtInfo.expires = ((jwtInfo.payload.exp - Date.now().valueOf() / 1000) / 60).toFixed(1);",
					"    jwtInfo.status = pm.response.code;",
					"",
					"    var template = `",
					"    <style>",
					"      body {",
					"        font-family: Arial, sans-serif;",
					"        padding: 20px;",
					"      }",
					"      table {",
					"        border-collapse: collapse;",
					"        width: 100%;",
					"        margin-bottom: 20px;",
					"      }",
					"      table, th, td {",
					"        border: 1px solid #ddd;",
					"        padding: 8px;",
					"      }",
					"      th {",
					"        background-color: #f2f2f2;",
					"        text-align: left;",
					"      }",
					"      tr:nth-child(even) {",
					"        background-color: #f9f9f9;",
					"      }",
					"      .header {",
					"        font-weight: bold;",
					"        font-size: 1.2em;",
					"        margin-bottom: 10px;",
					"      }",
					"      .signature {",
					"        margin-top: 20px;",
					"        font-style: italic;",
					"      }",
					"      pre {",
					"        white-space: pre-wrap;",
					"        word-wrap: break-word;",
					"      }",
					"    </style>",
					"",
					"    <div class=\"header\">Status: {{response.status}}, JWT Size: {{response.size}} Bytes. Expires in {{response.expires}} minutes</div>",
					"",
					"    <b>Header</b>",
					"    <table>",
					"        <tr><th>Property</th><th>Value</th></tr>",
					"        {{#each response.header}}",
					"            <tr><td>{{@key}}</td><td><pre>{{this}}</pre></td></tr>",
					"        {{/each}}",
					"    </table>",
					"",
					"    <b>Payload</b>",
					"    <table>",
					"        <tr><th>Property</th><th>Value</th></tr>",
					"        {{#each response.payload}}",
					"            <tr><td>{{@key}}</td><td><pre>{{this}}</pre></td></tr>",
					"        {{/each}}",
					"    </table>",
					"",
					"    <div class=\"signature\">Signature: {{response.signature}}</div>",
					"    `;",
					"",
					"    pm.visualizer.set(template, { response: jwtInfo });",
					"} else {",
					"    console.log(\"Response is not a valid JWT token.\");",
					"",
					"}",
					"",
					"",
					"qrTemplates = {",
					"    qrTemplate1: `",
					"    <style>",
					"      body {",
					"        font-family: Arial, sans-serif;",
					"        padding: 20px;",
					"      }",
					"      table {",
					"        border-collapse: collapse;",
					"        width: 100%;",
					"        margin-bottom: 20px;",
					"      }",
					"      table, th, td {",
					"        border: 1px solid #ddd;",
					"        padding: 8px;",
					"      }",
					"      th {",
					"        background-color: #f2f2f2;",
					"        text-align: left;",
					"      }",
					"      tr:nth-child(even) {",
					"        background-color: #f9f9f9;",
					"      }",
					"      .header {",
					"        font-weight: bold;",
					"        font-size: 1.2em;",
					"        margin-bottom: 10px;",
					"      }",
					"      .signature {",
					"        margin-top: 20px;",
					"        font-style: italic;",
					"      }",
					"      pre {",
					"        white-space: pre-wrap;",
					"        word-wrap: break-word;",
					"      }",
					"    ",
					"    .input{width:100%}",
					"    </style>",
					"",
					"    <div class=\"header\">QR Code for bank Auth URL</div>",
					"    <table>",
					"      <tr><td width=\"25%\"><img src=\"{{response.qrimage}}\" /></td><td><input value=\"{{response.url}}\" class=\"input\"/></td></tr>",
					"    </table>",
					"    ",
					"    ",
					"    ",
					"    `",
					"}",
					"",
					"utils = {",
					"    splitAndEncodeURL: function (url) {",
					"        // Split the URL into the base and query string parts",
					"        const [baseUrl, queryString] = url.split('?');",
					"",
					"        // If there's no query string, return the original URL",
					"        if (!queryString) return baseUrl;",
					"",
					"        let params = queryString.split('&');",
					"        let encodedParams = params.map(param => {",
					"            let [key, value] = param.split('=');",
					"            // Encode both key and value",
					"            let encodedKey = encodeURIComponent(key);",
					"            let encodedValue = encodeURIComponent(value);",
					"            return `${encodedKey}=${encodedValue}`;",
					"        });",
					"",
					"",
					"        // Reconstruct the URL with encoded query parameters",
					"        return `${baseUrl}?${encodedParams.join('&')}`;",
					"    },",
					"    visualizer: {",
					"        qrTemplate1: function () {",
					"            return qrTemplates.qrTemplate1;",
					"        },",
					"        qrTemplate: function (response) {",
					"            return `<img src=\"{{response}}\" />`;",
					"        },",
					"        qrData: function (myUrl) {",
					"            return { qrimage: `http://api.qrserver.com/v1/create-qr-code/?data=${myUrl}&size=300x300`, url: myUrl };",
					"        },",
					"        draw: function (visualizer, template, data) {",
					"            return visualizer.set(template, data);",
					"        }",
					"    }",
					"};",
					"",
					"",
					"",
					"var tenant = 'ALLICA';",
					"",
					"const usersByBank = {",
					"    ALLICA: [{",
					"        psuIdentifiers: {",
					"            userId: \"100001000000000000000002\"",
					"",
					"        },",
					"",
					"        accountIds: [",
					"            \"100004000000000000000002\"",
					"            // \"100004000000000000000003\",",
					"            // \"100004000000000000000004\",",
					"            // \"100004000000000000000005\",",
					"        ]",
					"    }],",
					"",
					"}",
					"const userDetails = usersByBank[tenant][0];",
					"",
					"pm.environment.set('userId', userDetails.psuIdentifiers.userId);",
					"// pm.environment.set('accountIds', JSON.stringify(userDetails.accountIds));",
					"// pm.environment.set('accountIdsPayment', JSON.stringify(userDetails.accountIds[0]));",
					"",
					"",
					""
				]
			}
		}
	]
}